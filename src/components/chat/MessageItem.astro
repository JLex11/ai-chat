---
interface Props {
  role: 'user' | 'assistant'
  content?: string
  timestamp?: number
  isTemplate?: boolean
}

const { role, content = '', timestamp, isTemplate = false } = Astro.props

const isUser = role === 'user'
const avatarText = isUser ? 'Tú' : 'IA'
const avatarBg = isUser ? 'bg-emerald-600' : 'bg-blue-600'
const nameText = isUser ? 'Tú' : 'Asistente'
const nameColor = isUser ? 'text-emerald-400' : 'text-blue-400'

function formatTime(ts: number): string {
  return new Date(ts).toLocaleTimeString('es', { hour: '2-digit', minute: '2-digit' })
}
---

<li class:list={['message group flex gap-3 p-4 rounded-lg transition-colors', { 'bg-slate-800/50': !isUser, hidden: isTemplate }]} data-role={role}>
  <div class:list={['avatar w-9 h-9 rounded-full flex items-center justify-center text-xs font-bold text-white shrink-0', avatarBg]}>
    {avatarText}
  </div>

  <div class='flex-1 min-w-0'>
    <div class='flex items-center gap-2 mb-1'>
      <span class:list={['font-semibold text-sm', nameColor]}>{nameText}</span>
      {timestamp && <span class='text-xs text-slate-500'>{formatTime(timestamp)}</span>}
    </div>

    <div class='message-content prose prose-invert prose-sm max-w-none' set:html={content} />
  </div>

  <div class='opacity-0 group-hover:opacity-100 transition-opacity flex items-start gap-1'>
    <button type='button' class='copy-btn p-1.5 text-slate-400 hover:text-white hover:bg-slate-700 rounded transition-colors' title='Copiar'>
      <svg class='w-4 h-4' fill='none' stroke='currentColor' viewBox='0 0 24 24'>
        <path
          stroke-linecap='round'
          stroke-linejoin='round'
          stroke-width='2'
          d='M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z'></path>
      </svg>
    </button>
  </div>
</li>
